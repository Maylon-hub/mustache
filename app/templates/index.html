{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>New Analysis</h2>
    <form id="uploadForm">
        <!-- Data Files Section -->
        <div class="param-section">
            <h3>Data Files</h3>
            <div class="form-group">
                <label for="file">Dataset (CSV) <span class="required">*</span></label>
                <input type="file" id="file" name="file" accept=".csv" required>
                <small>Upload your dataset as a CSV file with numerical features</small>
            </div>

            <div class="form-group">
                <label for="labels_file">Ground Truth Labels (Optional CSV)</label>
                <input type="file" id="labels_file" name="labels_file" accept=".csv">
                <small>Optional: Upload known labels for validation metrics</small>
            </div>
        </div>

        <!-- Clustering Parameters Section -->
        <div class="param-section">
            <h3>Clustering Parameters</h3>
            <div class="param-row">
                <div class="param-col">
                    <label>Min Cluster Size <span class="required">*</span></label>
                    <input type="number" name="min_cluster_size" value="5" min="2" required>
                    <small>Minimum number of points to form a cluster</small>
                </div>
                <div class="param-col">
                    <label>Min Samples</label>
                    <input type="number" name="min_samples" value="5" min="1">
                    <small>Core point neighborhood size (optional)</small>
                </div>
            </div>
            <div class="param-row" style="margin-top: 15px;">
                <div class="param-col">
                    <label>Distance Metric</label>
                    <select name="metric">
                        <option value="euclidean" selected>Euclidean (L2)</option>
                        <option value="manhattan">Manhattan (L1)</option>
                    </select>
                    <small>Distance function for density calculation</small>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">
            <i class="fas fa-play"></i> Run Clustering
        </button>
    </form>
</div>

<div id="results" class="card hidden">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0;">Results</h2>
        <button type="button" class="btn btn-secondary" onclick="exportResults()">
            <i class="fas fa-download"></i> Export JSON
        </button>
    </div>

    <div id="metrics" class="metrics-container"
        style="margin-bottom: 20px; padding: 15px; background: #e8f5e9; border-radius: 5px; display: none;">
        <h3>Validation Metrics</h3>
        <p><strong>ARI:</strong> <span id="ari-score">-</span></p>
        <p><strong>AMI:</strong> <span id="ami-score">-</span></p>
    </div>

    <div class="chart-container">
        <h3>Reachability Plot</h3>
        <div id="reachability" style="width:100%; height:400px;"></div>
    </div>

    <div class="chart-container">
        <h3>2D Projection (Map)</h3>
        <div id="map" style="width:100%; height:500px;"></div>
    </div>

    <div class="chart-container">
        <h3>Hierarchical Dendrogram</h3>
        <div id="dendrogram" style="width:100%; height:500px;"></div>
    </div>

    <h3>Raw Output</h3>
    <pre id="output"></pre>
</div>
{% endblock %}